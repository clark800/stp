
add_heading_ids() {
    sed -e '/^<h1>.*<\/h1>$/{s|^<h1>||;h;s|</h1>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h1 id="&">|;G;s|\n||;}' \
        -e '/^<h2>.*<\/h2>$/{s|^<h2>||;h;s|</h2>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h2 id="&">|;G;s|\n||;}' \
        -e '/^<h3>.*<\/h3>$/{s|^<h3>||;h;s|</h3>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h3 id="&">|;G;s|\n||;}' \
        -e '/^<h4>.*<\/h4>$/{s|^<h4>||;h;s|</h4>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h4 id="&">|;G;s|\n||;}' \
        -e '/^<h5>.*<\/h5>$/{s|^<h5>||;h;s|</h5>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h5 id="&">|;G;s|\n||;}' \
        -e '/^<h6>.*<\/h6>$/{s|^<h6>||;h;s|</h6>||;y| |_|;s|[^[:alnum:]_-]||g;s|^[^[:alpha:]]*||;s|.*|<h6 id="&">|;G;s|\n||;}' \
        -e 's|<h1 id="\([^"]*\)">\([^<>]*\)</h1>|<h1 id="\1"><a href="#\1">\2</a></h1>|'\
        -e 's|<h2 id="\([^"]*\)">\([^<>]*\)</h2>|<h2 id="\1"><a href="#\1">\2</a></h2>|'\
        -e 's|<h3 id="\([^"]*\)">\([^<>]*\)</h3>|<h3 id="\1"><a href="#\1">\2</a></h3>|'\
        -e 's|<h4 id="\([^"]*\)">\([^<>]*\)</h4>|<h4 id="\1"><a href="#\1">\2</a></h4>|'\
        -e 's|<h5 id="\([^"]*\)">\([^<>]*\)</h5>|<h5 id="\1"><a href="#\1">\2</a></h5>|'\
        -e 's|<h6 id="\([^"]*\)">\([^<>]*\)</h6>|<h6 id="\1"><a href="#\1">\2</a></h6>|'
}
